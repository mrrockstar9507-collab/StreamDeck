<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>StreamDeck</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0e1230">
  <style>
    :root{
      --bg:#0e1230; --card:#161d4b; --text:#f6fbff; --muted:#c0c9e6;
      --accent1:#88d0ff; --accent2:#ff7fd1; --accent3:#86ffb7; --accent4:#ffd166;
      --radius:16px; --shadow:0 14px 30px rgba(0,0,0,.35);
    }
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{color:inherit;text-decoration:none}

    .wrap{max-width:1140px;margin:0 auto;padding:22px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:6px}
    .logo{width:52px;height:52px;border-radius:14px;background:linear-gradient(135deg,var(--accent1),var(--accent2));display:grid;place-items:center;cursor:pointer;box-shadow:var(--shadow)}
    .logo svg{width:28px;height:28px}
    .brand{
      font-size:2.2rem;font-weight:900;
      background:repeating-linear-gradient(to right,#b88052 0 36px,#b17648 36px 38px,#b88052 38px 74px,#ad6f3e 74px 76px);
      -webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 2px 0 rgba(0,0,0,.25)
    }

    .tabs{display:flex;gap:10px;margin:14px 0;flex-wrap:wrap}
    .tabbtn{padding:10px 14px;border-radius:12px;background:#152172;color:#fff;border:1px solid rgba(255,255,255,.16);cursor:pointer}
    .tabbtn.active{background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#08112e;border:none}

    .panel{display:none}.panel.active{display:block}
    .card{background:var(--card);border-radius:var(--radius);border:1px solid rgba(255,255,255,.14);padding:16px;box-shadow:var(--shadow)}

    input,select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:#0e1a66;color:#fff}
    button{padding:10px 16px;border-radius:10px;border:none;background:linear-gradient(135deg,var(--accent2),var(--accent1));color:#07112e;font-weight:800;cursor:pointer;box-shadow:0 0 14px rgba(136,208,255,.3)}
    button:hover{transform:translateY(-1px)}

    .results{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;margin-top:16px}
    .tile{display:flex;gap:12px;background:#131a5a;border:1px solid rgba(255,255,255,.16);border-radius:14px;padding:10px}
    .tile img{width:100px;height:150px;border-radius:10px;object-fit:cover;background:#000}
    .meta{display:flex;flex-direction:column;gap:6px}
    .title{font-weight:800}
    .providers{display:flex;gap:6px;flex-wrap:wrap}
    .chip{background:#0f1a66;padding:4px 10px;border-radius:999px;font-size:.85rem}

    /* CRISP provider logos */
    .logoLinks{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .logoLink{
      display:flex;align-items:center;justify-content:center;
      width:40px;height:40px;border-radius:10px;
      background:#0e1a66;border:1px solid rgba(255,255,255,.2);
      box-shadow:0 0 14px rgba(136,208,255,.18);
      overflow:hidden;transition:transform .06s ease
    }
    .logoLink:hover{transform:translateY(-1px)}
    .logoImg{
      max-width:76%;max-height:76%;
      width:auto;height:auto;
      object-fit:contain;display:block;image-rendering:auto
    }

    /* Genre chips */
    .chips{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .gchip{background:linear-gradient(135deg,var(--accent3),var(--accent4));padding:10px 14px;border-radius:999px;cursor:pointer}
    .gchip:hover{filter:brightness(1.1)}
    .gchip.active{outline:2px solid rgba(255,255,255,.4)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div id="homeLogo" class="logo"><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2"><path d="M12 2 v8"></path><path d="M5.5 5.5a 8 8 0 1 0 13 0"></path></svg></div>
      <div class="brand">StreamDeck</div>
    </header>

    <div class="tabs">
      <button class="tabbtn active" data-tab="search">Search</button>
      <button class="tabbtn" data-tab="service">By Service</button>
      <button class="tabbtn" data-tab="genres">Browse by Genre</button>
      <button class="tabbtn" data-tab="actors">Browse by Actor</button>
    </div>

    <section id="search" class="panel active">
      <div class="card">
        <div class="row">
          <input id="q" type="search" placeholder="Search movies or TV shows…">
          <select id="searchType"><option value="multi">All</option><option value="movie">Movies</option><option value="tv">TV</option></select>
          <button id="go">Search</button>
        </div>
        <div id="searchResults" class="results"></div>
      </div>
    </section>

    <section id="service" class="panel">
      <div class="card">
        <div class="row">
          <select id="servicePicker"><option>Netflix</option><option>Hulu</option><option>Disney+</option><option>Max</option><option>Amazon Prime Video</option><option>Apple TV+</option><option>Peacock</option><option>Paramount+</option><option>Crunchyroll</option></select>
          <select id="serviceType"><option value="movie">Movies</option><option value="tv">TV</option></select>
          <select id="serviceGenre"></select>
          <button id="serviceGo">Search This Service</button>
        </div>
        <div id="serviceResults" class="results"></div>
      </div>
    </section>

    <section id="genres" class="panel">
      <div class="card">
        <select id="genreType"><option value="movie">Movies</option><option value="tv">TV</option></select>
        <div id="genreChips" class="chips"></div>
        <div id="genreResults" class="results"></div>
      </div>
    </section>

    <section id="actors" class="panel">
      <div class="card">
        <input id="actorQuery" type="text" placeholder="Search for an actor…">
        <button id="actorGo">Find Actor</button>
        <div id="actorList" class="results"></div>
        <div id="actorBreakdowns"></div>
      </div>
    </section>
  </div>

  <script>
    const TMDB_TOKEN="YOUR_TOKEN_HERE";
    const TMDB_BASE="https://api.themoviedb.org/3";
    const TMDB_IMG="https://image.tmdb.org/t/p";
    const REGION="US";
    const auth={headers:{Authorization:`Bearer ${TMDB_TOKEN}`,Accept:"application/json"}};

    const poster=p=>p?`${TMDB_IMG}/w342${p}`:"https://via.placeholder.com/140x210?text=No+Image";
    const smallPoster=p=>p?`${TMDB_IMG}/w185${p}`:"https://via.placeholder.com/100x150?text=No+Image";
    const safe=s=>(s||"").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    const yearOf=d=>d?d.split("-")[0]:"";

    function providerLogoImg(provider){
      const name=provider.provider_name||"Provider";
      if(provider.logo_path){
        const src1x=`${TMDB_IMG}/w92${provider.logo_path}`;
        const src2x=`${TMDB_IMG}/w154${provider.logo_path}`;
        return `<img class="logoImg" src="${src1x}" srcset="${src1x} 1x, ${src2x} 2x" sizes="40px" alt="${safe(name)}">`;
      }
      const initials=name.split(/\s+/).map(w=>w[0]).join("").slice(0,3).toUpperCase();
      return `<span style="font-weight:900;color:#fff">${initials}</span>`;
    }

    async function getProviders(id,media){
      const r=await fetch(`${TMDB_BASE}/${media}/${id}/watch/providers`,auth);
      return r.json();
    }

    function providerTitleURL(name,title,year){
      const q=encodeURIComponent(`${title} ${year||""}`.trim());
      if(name==="Netflix")return`https://www.netflix.com/search?q=${q}`;
      if(name==="Hulu")return`https://www.hulu.com/search?q=${q}`;
      if(name==="Disney+")return`https://www.disneyplus.com/search?q=${q}`;
      return`https://www.google.com/search?q=${q}+site:${name.toLowerCase().replace(/\s+/g,"")}.com`;
    }

    function providerButtons(title,year,provUS){
      const combined=[...(provUS.flatrate||[]),...(provUS.buy||[]),...(provUS.rent||[])];
      const seen=new Set();
      const btns=[];
      combined.forEach(p=>{
        if(seen.has(p.provider_name))return;
        seen.add(p.provider_name);
        btns.push(`<a class="logoLink" href="${providerTitleURL(p.provider_name,title,year)}" target="_blank">${providerLogoImg(p)}</a>`);
      });
      return `<div class="logoLinks">${btns.join("")}</div>`;
    }

    function resultTile(item,prov){
      const title=item.title||item.name;
      const media=item.media_type||"movie";
      const y=yearOf(item.release_date||item.first_air_date);
      const us=prov?.results?.[REGION]||{};
      return `<div class="tile">
        <img src="${smallPoster(item.poster_path)}">
        <div class="meta">
          <div class="title">${safe(title)}</div>
          <div class="sub">${media.toUpperCase()} ${y?("· "+y):""}</div>
          ${providerButtons(title,y,us)}
        </div>
      </div>`;
    }

    async function doSearch(){
      const q=document.getElementById("q").value.trim();
      const t=document.getElementById("searchType").value;
      if(!q)return;
      const out=document.getElementById("searchResults");
      out.innerHTML="Searching…";
      const data=await fetch(`${TMDB_BASE}/search/${t==="multi"?"multi":t}?query=${encodeURIComponent(q)}`,auth).then(r=>r.json());
      out.innerHTML="";
      for(const it of data.results||[]){
        const prov=await getProviders(it.id,it.media_type||"movie");
        out.insertAdjacentHTML("beforeend",resultTile(it,prov));
      }
    }

    document.getElementById("go").addEventListener("click",doSearch);
    document.querySelectorAll(".tabbtn").forEach(btn=>btn.addEventListener("click",()=>{document.querySelectorAll(".panel").forEach(p=>p.classList.toggle("active",p.id===btn.dataset.tab));document.querySelectorAll(".tabbtn").forEach(b=>b.classList.toggle("active",b===btn));}));
    document.getElementById("homeLogo").addEventListener("click",()=>{document.querySelectorAll(".panel").forEach(p=>p.classList.toggle("active",p.id==="search"));document.querySelectorAll(".tabbtn").forEach(b=>b.classList.toggle("active",b.dataset.tab==="search"));});
  </script>
</body>
</html>
